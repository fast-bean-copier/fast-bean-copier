# Fast Bean Copier 实施计划

## 文档信息

| 项目名称 | Fast Bean Copier              |
|---------|-------------------------------|
| 项目坐标 | com.github.jackieonway        |
| 项目名称 | fast-bean-copier              |
| 包名 | com.github.jackieonway.copier |
| 计划版本 | v1.0                          |
| 编写日期 | 2025                          |
| 最后更新 | 2025                          |

---

## 一、计划概述

本实施计划将 Fast Bean Copier 项目分解为 10 个可编译验证的阶段，每个阶段完成后都要求编译通过。

### 计划特点

- **模块化设计**：按功能模块分阶段实现
- **编译驱动**：每个阶段完成后必须编译通过
- **递进式实现**：从基础功能逐步到高级功能
- **测试驱动**：每个阶段包含相应的单元测试

---

## 二、项目结构准备

### 阶段 1：项目基础框架搭建

**目标**：建立项目的基本结构和依赖配置

**工作内容**：

1. **创建多模块Maven项目结构**
   - 创建父模块 `fast-bean-copier`
   - 创建子模块 `fast-bean-copier-annotations`
   - 创建子模块 `fast-bean-copier-processor`
   - 创建子模块 `fast-bean-copier-examples`（可选）

2. **配置父模块 pom.xml**
   - 定义项目坐标：`com.github.jackieonway:fast-bean-copier`
   - 定义版本号：`1.0.0`
   - 配置Java版本：Java 8
   - 配置常用依赖版本

3. **配置注解模块 pom.xml**
   - 定义模块坐标：`com.github.jackieonway:fast-bean-copier-annotations`
   - 配置基础依赖

4. **配置处理器模块 pom.xml**
   - 定义模块坐标：`com.github.jackieonway:fast-bean-copier-processor`
   - 配置APT相关依赖（JavaPoet、Auto Service等）
   - 配置编译插件

5. **创建基础目录结构**
   - 创建 `src/main/java` 目录
   - 创建 `src/test/java` 目录
   - 创建 `docs` 目录

**验收标准**：
- [ ] 项目结构完整，所有模块创建成功
- [ ] 所有 pom.xml 文件配置正确
- [ ] 项目能够成功编译（mvn clean compile）
- [ ] 没有编译错误和警告

**编译验证命令**：
```bash
mvn clean compile
```

---

## 三、注解定义阶段

### 阶段 2：@CopyTarget 注解定义

**目标**：定义项目的核心注解

**工作内容**：

1. **创建注解类**
   - 文件路径：`fast-bean-copier-annotations/src/main/java/com/github/jackieonway/copier/annotation/CopyTarget.java`
   - 注解名称：`@CopyTarget`
   - 注解目标：`ElementType.TYPE`
   - 注解保留期：`RetentionPolicy.SOURCE`

2. **定义注解属性**
   - `source`：源类（必需）
   - `ignore`：忽略的字段列表（可选，默认为空）

3. **添加注解文档**
   - 添加 JavaDoc 注释
   - 说明注解的用途和使用方式

**验收标准**：
- [ ] 注解类创建成功
- [ ] 注解属性定义正确
- [ ] 注解文档完整
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
```

---

## 四、APT处理器基础阶段

### 阶段 3：APT处理器框架和基础工具类

**目标**：建立APT处理器的基本框架和工具类

**工作内容**：

1. **创建 BeanCopierProcessor 类**
   - 文件路径：`fast-bean-copier-processor/src/main/java/com/github/jackieonway/copier/processor/BeanCopierProcessor.java`
   - 继承 `AbstractProcessor`
   - 实现 `getSupportedAnnotationTypes()` 方法
   - 实现 `getSupportedSourceVersion()` 方法
   - 实现基础的 `process()` 方法框架

2. **创建 TypeUtils 工具类**
   - 文件路径：`fast-bean-copier-processor/src/main/java/com/github/jackieonway/copier/processor/TypeUtils.java`
   - 实现类型检查方法：`isPrimitive()`、`isWrapper()` 等
   - 实现类型转换方法
   - 实现字段获取方法

3. **创建 FieldMapping 类**
   - 文件路径：`fast-bean-copier-processor/src/main/java/com/github/jackieonway/copier/processor/FieldMapping.java`
   - 用于表示源字段和目标字段的映射关系
   - 包含字段名、类型等信息

4. **创建 CodeGenerator 类框架**
   - 文件路径：`fast-bean-copier-processor/src/main/java/com/github/jackieonway/copier/processor/CodeGenerator.java`
   - 使用 JavaPoet 生成代码
   - 实现基础的代码生成框架

5. **配置 Auto Service**
   - 在 `BeanCopierProcessor` 上添加 `@AutoService(Processor.class)` 注解
   - 实现自动注册APT处理器

**验收标准**：
- [ ] 所有类创建成功
- [ ] 类结构完整，方法签名正确
- [ ] 项目能够成功编译
- [ ] 没有编译错误和警告

**编译验证命令**：
```bash
mvn clean compile
```

---

## 五、基础功能实现阶段

### 阶段 4：同名字段自动拷贝（基础）

**目标**：实现同名字段的自动拷贝功能

**工作内容**：

1. **完善 TypeUtils 工具类**
   - 实现 `isPrimitive()` 方法：判断是否为基本类型
   - 实现 `isWrapper()` 方法：判断是否为包装类型
   - 实现 `isTypeCompatible()` 方法：判断两个类型是否兼容
   - 实现 `getFieldType()` 方法：获取字段类型
   - 实现 `getAllFields()` 方法：获取类的所有字段

2. **完善 FieldMapping 类**
   - 添加字段类型信息
   - 添加类型兼容性检查
   - 添加映射验证方法

3. **实现基础的字段映射逻辑**
   - 在 `BeanCopierProcessor` 中实现字段映射分析
   - 找出源类和目标类中的同名字段
   - 检查字段类型兼容性

4. **实现基础的代码生成**
   - 在 `CodeGenerator` 中实现 `toDto()` 方法生成
   - 生成同名字段的拷贝代码
   - 生成 null 检查代码

5. **编写单元测试**
   - 创建测试类：`SameNameFieldCopyTest`
   - 测试同名字段拷贝
   - 测试类型兼容性检查

**验收标准**：
- [ ] 同名字段能够正确拷贝
- [ ] 生成的代码格式正确
- [ ] 单元测试通过
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
```

---

### 阶段 5：基本类型与包装类型转换

**目标**：实现基本类型与包装类型的自动转换

**工作内容**：

1. **完善 TypeUtils 工具类**
   - 实现 `getWrapperType()` 方法：获取基本类型对应的包装类型
   - 实现 `getPrimitiveType()` 方法：获取包装类型对应的基本类型
   - 实现 `getDefaultValue()` 方法：获取基本类型的默认值

2. **实现类型转换代码生成**
   - 基本类型 -> 包装类型：自动装箱
   - 包装类型 -> 基本类型：自动拆箱 + null 处理
   - 在 `CodeGenerator` 中实现转换代码生成

3. **完善字段映射逻辑**
   - 支持基本类型与包装类型的映射
   - 在类型兼容性检查中添加转换逻辑

4. **编写单元测试**
   - 创建测试类：`PrimitiveWrapperConversionTest`
   - 测试基本类型 -> 包装类型转换
   - 测试包装类型 -> 基本类型转换
   - 测试 null 值处理

**验收标准**：
- [ ] 基本类型与包装类型能够自动转换
- [ ] null 值处理正确
- [ ] 生成的代码格式正确
- [ ] 单元测试通过
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
```

---

### 阶段 6：字段忽略功能

**目标**：实现字段忽略功能

**工作内容**：

1. **完善 BeanCopierProcessor 类**
   - 从 `@CopyTarget` 注解中读取 `ignore` 属性
   - 验证忽略的字段是否存在（不存在给出警告）
   - 在字段映射时排除忽略的字段

2. **完善 CodeGenerator 类**
   - 在代码生成时跳过忽略的字段
   - 不为忽略的字段生成拷贝代码

3. **编写单元测试**
   - 创建测试类：`FieldIgnoreTest`
   - 测试字段忽略功能
   - 测试不存在的忽略字段警告

**验收标准**：
- [ ] 忽略的字段不会被拷贝
- [ ] 不存在的忽略字段给出警告
- [ ] 生成的代码格式正确
- [ ] 单元测试通过
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
```

---

### 阶段 7：类型安全检查（编译期）

**目标**：实现编译期的类型安全检查

**工作内容**：

1. **完善 BeanCopierProcessor 类**
   - 实现源类和目标类的存在性检查
   - 实现字段类型兼容性检查
   - 实现 getter/setter 方法存在性检查
   - 生成编译期错误信息

2. **完善错误处理**
   - 使用 `Messager` 生成编译期错误和警告
   - 提供清晰的错误提示信息

3. **编写单元测试**
   - 创建测试类：`TypeSafetyCheckTest`
   - 测试不存在的类检查
   - 测试类型不兼容检查
   - 测试缺少 getter/setter 检查

**验收标准**：
- [ ] 不存在的类能够被检测并报错
- [ ] 类型不兼容能够被检测并报错
- [ ] 缺少 getter/setter 方法能够被检测并报错
   - [ ] 错误提示清晰友好
- [ ] 单元测试通过
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
```

---

## 六、嵌套对象处理阶段

### 阶段 8：嵌套对象深拷贝（有注解）

**目标**：实现有 @CopyTarget 注解的嵌套对象的深拷贝

**工作内容**：

1. **完善 TypeUtils 工具类**
   - 实现 `hasCopyTargetAnnotation()` 方法：检查类是否有 @CopyTarget 注解
   - 实现 `isNestedObject()` 方法：检查字段是否为嵌套对象

2. **完善 BeanCopierProcessor 类**
   - 实现嵌套对象的检测
   - 实现循环依赖检测
   - 记录嵌套对象的 Copier 调用

3. **完善 CodeGenerator 类**
   - 实现嵌套对象的代码生成
   - 生成 Copier 调用代码
   - 生成 null 检查代码

4. **编写单元测试**
   - 创建测试类：`NestedObjectAnnotatedTest`
   - 测试有注解的嵌套对象拷贝
   - 测试循环依赖检测

**验收标准**：
- [ ] 有注解的嵌套对象能够正确调用 Copier 进行深拷贝
- [ ] 循环依赖能够被检测并报错
- [ ] 生成的代码格式正确
- [ ] 单元测试通过
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
```

---

### 阶段 9：嵌套对象深拷贝（无注解）

**目标**：实现无 @CopyTarget 注解的嵌套对象的深拷贝

**工作内容**：

1. **完善 TypeUtils 工具类**
   - 实现 `isTypeMatch()` 方法：检查两个类型是否完全匹配
   - 实现 `getNestedFields()` 方法：获取嵌套对象的所有字段

2. **完善 BeanCopierProcessor 类**
   - 实现无注解嵌套对象的检测
   - 实现类型匹配检查
   - 验证 getter/setter 方法存在性

3. **完善 CodeGenerator 类**
   - 实现无注解嵌套对象的递归深拷贝代码生成
   - 生成嵌套对象的创建和字段拷贝代码
   - 生成 null 检查代码

4. **编写单元测试**
   - 创建测试类：`NestedObjectUnannotatedTest`
   - 测试无注解的嵌套对象拷贝
   - 测试多级嵌套对象拷贝
   - 测试类型不匹配检查

**验收标准**：
- [ ] 无注解的嵌套对象能够递归深拷贝所有字段
- [ ] 多级嵌套对象能够正确递归深拷贝
- [ ] 类型不匹配能够被检测并报错
- [ ] 生成的代码格式正确
- [ ] 单元测试通过
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
```

---

## 七、集合处理阶段

### 阶段 10：集合拷贝（List 和 Set）

**目标**：实现 List 和 Set 的优化拷贝

**工作内容**：

1. **完善 TypeUtils 工具类**
   - 实现 `isList()` 方法：检查是否为 List 类型
   - 实现 `isSet()` 方法：检查是否为 Set 类型
   - 实现 `getCollectionElementType()` 方法：获取集合元素类型

2. **完善 BeanCopierProcessor 类**
   - 实现集合类型的检测
   - 实现集合元素类型的提取

3. **完善 CodeGenerator 类**
   - 实现 `toDtoList()` 方法生成（预分配容量 + 传统 for 循环）
   - 实现 `toDtoSet()` 方法生成（预分配容量 + 传统 for 循环）
   - 生成 null 和空集合处理代码
   - 生成集合元素的递归拷贝代码

4. **编写单元测试**
   - 创建测试类：`CollectionCopyTest`
   - 测试 List 拷贝
   - 测试 Set 拷贝
   - 测试 null 和空集合处理
   - 测试集合中的嵌套对象拷贝

**验收标准**：
- [ ] List 能够正确拷贝并保持顺序
- [ ] Set 能够正确拷贝并保持去重特性
- [ ] null 集合和空集合能够正确处理
- [ ] 集合中的嵌套对象能够正确递归深拷贝
- [ ] 生成的代码使用预分配容量和传统 for 循环
- [ ] 单元测试通过
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
```

---

## 八、反向拷贝阶段

### 阶段 11：反向拷贝（fromDto 方法）

**目标**：实现反向拷贝功能

**工作内容**：

1. **完善 CodeGenerator 类**
   - 实现 `fromDto()` 方法生成
   - 实现字段映射反向处理
   - 实现类型转换反向处理
   - 实现嵌套对象反向拷贝代码生成
   - 生成 null 检查代码

2. **完善 BeanCopierProcessor 类**
   - 确保反向拷贝使用相同的字段映射规则
   - 确保忽略字段在反向拷贝中同样被忽略

3. **编写单元测试**
   - 创建测试类：`ReverseObjectCopyTest`
   - 测试 fromDto 方法生成
   - 测试反向拷贝功能
   - 测试嵌套对象反向处理
   - 测试类型转换反向处理

**验收标准**：
- [ ] fromDto 方法能够正确生成
- [ ] 反向拷贝能够正确工作
- [ ] 字段映射在反向拷贝中保持一致
- [ ] 嵌套对象反向处理正确
- [ ] 类型转换反向处理正确
- [ ] 单元测试通过
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
```

---

### 阶段 12：集合反向拷贝（fromDtoList 和 fromDtoSet）

**目标**：实现集合的反向拷贝

**工作内容**：

1. **完善 CodeGenerator 类**
   - 实现 `fromDtoList()` 方法生成
   - 实现 `fromDtoSet()` 方法生成
   - 生成 null 和空集合处理代码
   - 生成集合元素的递归反向拷贝代码

2. **编写单元测试**
   - 创建测试类：`ReverseCollectionCopyTest`
   - 测试 fromDtoList 方法
   - 测试 fromDtoSet 方法
   - 测试 null 和空集合处理
   - 测试集合中的嵌套对象反向拷贝

**验收标准**：
- [ ] fromDtoList 方法能够正确生成
- [ ] fromDtoSet 方法能够正确生成
- [ ] 列表反向拷贝能够正确工作
- [ ] 集合反向拷贝能够正确工作
- [ ] 集合中的嵌套对象能够正确递归反向拷贝
- [ ] 单元测试通过
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
```

---

## 九、测试和优化阶段

### 阶段 13：集成测试和性能测试

**目标**：进行集成测试和性能基准测试

**工作内容**：

1. **编写集成测试**
   - 创建测试类：`IntegrationTest`
   - 测试完整的拷贝流程
   - 测试复杂的嵌套对象场景
   - 测试大规模集合拷贝

2. **编写性能测试**
   - 创建性能测试类：`PerformanceBenchmarkTest`
   - 测试单个对象拷贝性能
   - 测试批量对象拷贝性能
   - 测试嵌套对象拷贝性能
   - 测试集合拷贝性能
   - 生成性能报告

3. **代码覆盖率检查**
   - 运行代码覆盖率分析
   - 确保覆盖率 > 80%

**验收标准**：
- [ ] 集成测试通过
- [ ] 性能测试通过，性能指标达到预期
- [ ] 代码覆盖率 > 80%
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn test
mvn jacoco:report
```

---

### 阶段 14：文档和示例完善

**目标**：完善项目文档和示例代码

**工作内容**：

1. **编写 README 文档**
   - 项目简介
   - 快速开始指南
   - 功能特性说明
   - 使用示例

2. **编写 API 文档**
   - 注解文档
   - 生成的 Copier 类文档
   - 工具类文档

3. **编写使用指南**
   - 基础使用指南
   - 高级功能指南
   - 常见问题解答

4. **完善示例代码**
   - 基础使用示例
   - 嵌套对象示例
   - 集合拷贝示例
   - 反向拷贝示例

5. **生成 JavaDoc**
   - 为所有公开类和方法添加 JavaDoc
   - 生成 JavaDoc 文档

**验收标准**：
- [ ] README 文档完整清晰
- [ ] API 文档完整
- [ ] 使用指南清晰易懂
- [ ] 示例代码完整可运行
- [ ] JavaDoc 生成成功
- [ ] 项目能够成功编译

**编译验证命令**：
```bash
mvn clean compile
mvn javadoc:javadoc
```

---

## 十、发布准备阶段

### 阶段 15：最终验收和发布准备

**目标**：进行最终验收和发布准备

**工作内容**：

1. **最终编译验证**
   - 执行完整的 Maven 构建
   - 确保所有模块编译通过
   - 确保所有测试通过

2. **质量检查**
   - 代码规范检查
   - 性能指标验证
   - 兼容性验证

3. **发布准备**
   - 配置发布仓库
   - 准备发布脚本
   - 准备版本标签

**验收标准**：
- [ ] 完整的 Maven 构建通过
- [ ] 所有测试通过
- [ ] 代码规范检查通过
- [ ] 性能指标达到预期
- [ ] 兼容性验证通过
- [ ] 发布准备完成

**编译验证命令**：
```bash
mvn clean install
mvn test
```

---

## 十一、计划总结

### 阶段划分

| 阶段 | 名称 | 关键任务 | 编译验证 |
|------|------|--------|--------|
| 1 | 项目基础框架搭建 | 创建多模块结构、配置 pom.xml | mvn clean compile |
| 2 | @CopyTarget 注解定义 | 定义注解及其属性 | mvn clean compile |
| 3 | APT处理器框架 | 创建处理器和工具类 | mvn clean compile |
| 4 | 同名字段自动拷贝 | 实现基础字段映射和代码生成 | mvn clean compile; mvn test |
| 5 | 基本类型与包装类型转换 | 实现类型转换代码生成 | mvn clean compile; mvn test |
| 6 | 字段忽略功能 | 实现字段忽略逻辑 | mvn clean compile; mvn test |
| 7 | 类型安全检查 | 实现编译期类型检查 | mvn clean compile; mvn test |
| 8 | 嵌套对象深拷贝（有注解） | 实现有注解嵌套对象处理 | mvn clean compile; mvn test |
| 9 | 嵌套对象深拷贝（无注解） | 实现无注解嵌套对象处理 | mvn clean compile; mvn test |
| 10 | 集合拷贝 | 实现 List 和 Set 拷贝 | mvn clean compile; mvn test |
| 11 | 反向拷贝 | 实现 fromDto 方法生成 | mvn clean compile; mvn test |
| 12 | 集合反向拷贝 | 实现 fromDtoList 和 fromDtoSet | mvn clean compile; mvn test |
| 13 | 集成和性能测试 | 编写集成测试和性能测试 | mvn clean compile; mvn test |
| 14 | 文档和示例完善 | 编写文档和示例代码 | mvn clean compile; mvn javadoc:javadoc |
| 15 | 最终验收和发布准备 | 最终验收和发布准备 | mvn clean install; mvn test |

### 关键里程碑

- **里程碑 1**（阶段 3）：APT处理器框架完成，项目基础建立
- **里程碑 2**（阶段 7）：基础功能完成，编译期检查实现
- **里程碑 3**（阶段 10）：核心功能完成，集合处理实现
- **里程碑 4**（阶段 12）：反向拷贝完成，功能全面
- **里程碑 5**（阶段 15）：最终验收完成，项目发布

### 风险和应对

| 风险 | 影响 | 应对措施 |
|------|------|--------|
| APT处理器复杂度高 | 开发周期长 | 分阶段实现，逐步增加功能 |
| 代码生成质量难以保证 | 生成代码有bug | 编写充分的单元测试和集成测试 |
| 性能指标难以达到 | 项目目标无法实现 | 提前进行性能测试，及时优化 |
| 循环依赖检测复杂 | 实现难度大 | 使用图论算法，充分测试 |

---

## 十二、执行指南

### 执行流程

1. **每个阶段的执行步骤**
   - 阅读阶段目标和工作内容
   - 实现相关代码
   - 编写单元测试
   - 执行编译验证命令
   - 确保编译通过和测试通过
   - 更新计划状态

2. **编译验证要求**
   - 每个阶段完成后必须执行编译验证命令
   - 编译必须通过，没有错误和警告
   - 所有测试必须通过
   - 代码必须符合规范

3. **问题处理**
   - 如果编译失败，立即修复问题
   - 如果测试失败，分析原因并修复
   - 如果无法继续，回溯到上一个稳定阶段

### 工具和环境

- **Java 版本**：Java 8+
- **Maven 版本**：Maven 3.6+
- **IDE**：IntelliJ IDEA 或 Eclipse
- **构建工具**：Maven

### 常用命令

```bash
# 清理和编译
mvn clean compile

# 运行测试
mvn test

# 完整构建
mvn clean install

# 生成 JavaDoc
mvn javadoc:javadoc

# 代码覆盖率
mvn jacoco:report

# 查看编译错误
mvn clean compile -X
```

---

**计划结束**
